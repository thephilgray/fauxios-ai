---
interface Props {
  title: string;
  description: string;
  ogImageUrl: string;
}

const { title, description, ogImageUrl } = Astro.props;
import '../styles/global.css';
import { Resource } from "sst";

interface Article {
  topic?: string;
  createdAt: string;
}

const apiUrl = Resource.Api.url;
let topics: string[] = [];

try {
  const response = await fetch(`${apiUrl}/articles`);
  if (response.ok) {
    const allArticles: Article[] = await response.json();
    // Sort articles by createdAt in descending order
    allArticles.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
    const recentTopics = [...new Set(allArticles.map(article => article.topic || "News").filter(Boolean) as string[])];
    topics = recentTopics.slice(0, 4); // Get the first 4 unique topics
  } else {
    console.error(`Failed to fetch articles for topics: ${response.status} ${response.statusText}`);
  }
} catch (error) {
  console.error("Error fetching topics:", error);
}
import Adsense from '../components/Adsense.astro';

const adsenseEnabled = import.meta.env.PUBLIC_ADSENSE_ENABLED === 'true';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />

    <!-- Open Graph Tags -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:type" content="article" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />

    <title>{title}</title>
    {adsenseEnabled && (
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6862199621986980"
       crossorigin="anonymous"></script>
    )}
  </head>
  <body class="font-sans antialiased text-gray-900 bg-gray-50 flex flex-col min-h-screen">
    <header class="bg-white shadow-sm py-3">
      <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
        <a href="/" class="flex items-center justify-center min-w-fit bg-black p-2 rounded">
          <img src="/images/favicon-white.svg" alt="Fauxios Logo" class="h-8 w-auto mr-2" />
          <span class="text-2xl font-semibold text-white">Fauxios</span>
        </a>
        <nav class="flex flex-wrap justify-center gap-4 mt-4 md:mt-0">
          <a href="/" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>
          {topics.map((topicItem, index) => (
            <a 
              href={`/topics/${topicItem.toLowerCase()}`}
              class={`text-gray-700 hover:text-blue-600 font-medium ${
                index >= 2 ? 'hidden md:inline' : ''
              }`}>
              {topicItem.charAt(0).toUpperCase() + topicItem.slice(1)}
            </a>
          ))}
        </nav>
      </div>
    </header>

    <main class="container mx-auto px-2 py-2 md:px-4 md:py-4 flex-grow">
      <Adsense />
      <slot />
    </main>

    <footer class="bg-gray-800 text-white py-6 mt-12">
      <div class="container mx-auto px-4 text-center">
        <p>&copy; {new Date().getFullYear()} Fauxios. All rights reserved.</p>
        <p class="text-sm text-gray-400 mt-2">Fauxios is a satirical news website. All articles are fictional and intended for entertainment purposes only.</p>
        <div class="mt-4">
          <a href="/about" class="text-sm text-gray-400 hover:text-white mx-2">About Us</a>
          <span class="text-sm text-gray-400">|</span>
          <a href="/contact" class="text-sm text-gray-400 hover:text-white mx-2">Contact Us</a>
        </div>
      </div>
    </footer>
  </body>
</html>